<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Codeforces 远程评测</title>
<style>
body { font-family: Arial; max-width: 900px; margin: 40px auto; padding: 0 20px; }
label, input, select, textarea, button { display: block; margin-bottom: 10px; width: 100%; }
textarea { height: 300px; font-family: monospace; }
button { padding: 8px; background: #4CAF50; color: white; border: none; cursor: pointer; }
button:hover { background: #45a049; }
.result { padding: 10px; border-radius: 5px; margin: 5px 0; font-weight: bold; }
.ac { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
.wa { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
.ce { background: #fff3cd; color: #856404; border: 1px solid #ffeeba; }
.tle { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
.re { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
</style>
</head>
<body>

<h2>Codeforces 远程评测</h2>
<form id="submitForm">
  <label>JSESSIONID: <input name="jsessionid" type="text" required></label>
  <label>用户名: <input name="username" type="text" required></label>
  <label>题号: <input name="problem_id" type="text" required></label>
  <label>语言:
    <select name="language">
      <option value="42">GNU C++17</option>
      <option value="43">GNU C++20</option>
      <option value="50">Python 3</option>
    </select>
  </label>
  <label>源代码:<br>
    <textarea name="source" required></textarea>
  </label>
  <button type="submit">提交</button>
</form>

<div id="resultContainer"></div>

<script>
document.getElementById('submitForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    const form = e.target;
    const data = new URLSearchParams(new FormData(form));

    document.getElementById('resultContainer').innerHTML = "正在提交，请稍候...";

    try {
        const resp = await fetch('/.netlify/functions/submit_code', {
            method: 'POST',
            body: data
        });
        const htmlText = await resp.text();
        document.getElementById('resultContainer').innerHTML = htmlText;
    } catch (err) {
        document.getElementById('resultContainer').innerHTML = "<p style='color:red;'>提交失败，请检查网络或函数部署。</p>";
        console.error(err);
    }
});
</script>

</body>
</html>
