<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Codeforces 远程评测</title>
<style>
body{font-family: Arial; max-width:900px;margin:40px auto;padding:0 20px;}
label,input,select,textarea,button{display:block;margin-bottom:10px;width:100%;}
textarea{height:300px;font-family: monospace;}
button{padding:8px; background:#4CAF50; color:white; border:none; cursor:pointer;}
button:hover{background:#45a049;}
#result{margin-top:20px;padding:10px;border:1px solid #ccc;}
</style>
</head>
<body>
<h2>Codeforces 远程评测 (Netlify)</h2>
<form id="submitForm">
<label>JSESSIONID: <input name="jsessionid" type="text" required></label>
<label>用户名: <input name="username" type="text" required></label>
<label>题号 (如 1A): <input name="problem_id" type="text" required></label>
<label>语言:
<select name="language">
<option value="54">GNU G++17 7.3.0</option>
<option value="50">GNU C++14 6.4.0</option>
<option value="51">GNU C++17 7.3.0</option>
<option value="42">Python 3</option>
</select></label>
<label>源代码:<br><textarea name="source" required></textarea></label>
<button type="submit">提交</button>
</form>

<div id="result"></div>

<script>
document.getElementById('submitForm').onsubmit = async (e) => {
  e.preventDefault();
  const form = e.target;
  const data = {
    jsessionid: form.jsessionid.value,
    username: form.username.value,
    problem_id: form.problem_id.value,
    language: form.language.value,
    source: form.source.value
  };
  const resDiv = document.getElementById('result');
  resDiv.textContent = '正在提交，请稍候...';

  try {
    const resp = await fetch('/.netlify/functions/submit_code', {
      method: 'POST',
      body: JSON.stringify(data)
    });
    const json = await resp.json();
    resDiv.innerHTML = `<strong>题号:</strong> ${json.problem}<br>
                        <strong>RunID:</strong> ${json.runid}<br>
                        <strong>判定:</strong> ${json.verdict}<br>
                        <strong>时间:</strong> ${json.time}<br>
                        <strong>内存:</strong> ${json.memory}`;
  } catch(err) {
    resDiv.textContent = '提交失败: ' + err;
  }
};
</script>
</body>
</html>
